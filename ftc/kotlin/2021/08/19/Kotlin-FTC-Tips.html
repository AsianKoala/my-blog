<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>FTC Kotlin Tips &amp; Tricks | Neil Mehra</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="FTC Kotlin Tips &amp; Tricks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Tips and tricks for integrating Kotlin into your FTC projects." />
<meta property="og:description" content="Tips and tricks for integrating Kotlin into your FTC projects." />
<link rel="canonical" href="https://asiankoala.github.io/my-blog/ftc/kotlin/2021/08/19/Kotlin-FTC-Tips.html" />
<meta property="og:url" content="https://asiankoala.github.io/my-blog/ftc/kotlin/2021/08/19/Kotlin-FTC-Tips.html" />
<meta property="og:site_name" content="Neil Mehra" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-19T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2021-08-19T00:00:00-05:00","url":"https://asiankoala.github.io/my-blog/ftc/kotlin/2021/08/19/Kotlin-FTC-Tips.html","@type":"BlogPosting","dateModified":"2021-08-19T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://asiankoala.github.io/my-blog/ftc/kotlin/2021/08/19/Kotlin-FTC-Tips.html"},"headline":"FTC Kotlin Tips &amp; Tricks","description":"Tips and tricks for integrating Kotlin into your FTC projects.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/my-blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://asiankoala.github.io/my-blog/feed.xml" title="Neil Mehra" /><link rel="shortcut icon" type="image/x-icon" href="/my-blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/my-blog/">Neil Mehra</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/my-blog/about/">About Me</a><a class="page-link" href="/my-blog/search/">Search</a><a class="page-link" href="/my-blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">FTC Kotlin Tips &amp; Tricks</h1><p class="page-description">Tips and tricks for integrating Kotlin into your FTC projects.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-08-19T00:00:00-05:00" itemprop="datePublished">
        Aug 19, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/my-blog/categories/#FTC">FTC</a>
        &nbsp;
      
        <a class="category-tags-link" href="/my-blog/categories/#Kotlin">Kotlin</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h3"><a href="#neil-mehra">Neil Mehra</a></li>
<li class="toc-entry toc-h3"><a href="#-august-19-2021-"> August 19, 2021 </a></li>
<li class="toc-entry toc-h2"><a href="#enabling-kotlin">Enabling Kotlin</a></li>
<li class="toc-entry toc-h2"><a href="#converting-your-codebase-to-kotlin">Converting your codebase to Kotlin</a></li>
<li class="toc-entry toc-h2"><a href="#tips--tricks">Tips &amp; Tricks</a></li>
</ul><h3>
<a class="anchor" href="#neil-mehra" aria-hidden="true"><span class="octicon octicon-link"></span></a>Neil Mehra</h3>
<h3>
<a class="anchor" href="#-august-19-2021-" aria-hidden="true"><span class="octicon octicon-link"></span></a> August 19, 2021 </h3>
<p>
</p>

<p>Kotlin is a statically typed, modern, concise JVM language that is designed to be fully interoperable with Java. In FTC, the most popular motion planning library, &lt;a href=https://learnroadrunner.com/&gt;Road Runner,&lt;/a&gt; is written in Kotlin.</p>

<h2 id="enabling-kotlin">
<a class="anchor" href="#enabling-kotlin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enabling Kotlin</h2>

<p>First, we have to enable the Kotlin plugin in our root level gradle files. Navigate to <code>./build.gradle</code> and add this line to your buildscript</p>

<p><code>ext.kotlin_version = '1.5.21'</code></p>

<p><strong><em>Note:</em></strong> - at the time of writing 1.5.21 is the latest Kotlin release.</p>

<p>This creates an environment variable with name ‘kotlin_version’ and value ‘1.5.21’ so we don’t have to re-type the release version.</p>

<p>Next, add the Kotlin plugin to the dependencies block with this line<br>
<code>classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</code></p>

<p>If you haven’t already, make sure the language level of the Java source code and version of the generated Java bytecode are 1.8 (JDK 8). Open up <code>build.common.gradle</code> and check if your <code>compileOptions</code> block looks like this</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>compileOptions {  
        sourceCompatibility JavaVersion.VERSION_1_8  
        targetCompatibility JavaVersion.VERSION_1_8  
} 
</code></pre></div></div>

<p>Once that’s finished, all that’s left to do is to enable the <code>kotlin-android</code> and the <code>kotlin-stdlib-jdk8</code> plugins. Head over to the <code>build.gradle</code> of any modules you want to use Kotlin in.</p>

<p>Personally, I have Kotlin enabled in both the TeamCode and FTCRobotController modules as I converted the Java sample code that the FTC SDK provides to Kotlin to introduce my jr programmer to the SDK and Kotlin at the same time. Add the following definition to the top of your <code>build.gradle</code> file.
<code>apply plugin: 'kotlin-android'</code></p>

<p>Then add this line to your dependencies block.<br>
<code>implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version"</code></p>

<p>Sync your gradle changes and then you’re all good.</p>

<p>
</p>

<h2 id="converting-your-codebase-to-kotlin">
<a class="anchor" href="#converting-your-codebase-to-kotlin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Converting your codebase to Kotlin</h2>

<p>If you’re apprehensive about the how long it’ll take to rewrite everything, don’t worry. As Kotlin was designed to be fully functional with Java, Java source code can actually be converted directly into readable Kotlin code. Head over to Android Studio and press <code>ctrl+alt+shift+K</code> while a Java file is open to convert it to Kotlin.</p>

<p>Now that you have Kotlin files to work with, let me give some tips so that I wish I knew back when I started developing in Kotlin.</p>

<h2 id="tips--tricks">
<a class="anchor" href="#tips--tricks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tips &amp; Tricks</h2>
<ol>
  <li>
    <p>Data Classes<br>
 Whenever you have classes that are only for holding data, such as a <code>Vector</code> or <code>Point</code> class, turn them into a <code>data class</code>. Data classes contain automatically generated functions that are derived from the constructor fields, which makes life simpler. You can also do cool things with data classes like this:<br>
 <code> val (x, y) = Point(1.0, 2.0)</code></p>
  </li>
  <li>Custom getters/setters<br>
 I remember during one of my first days after switching to Kotlin, I spent an entire meeting trying to debug a StackOverflowError that made no sense at all. It was erroring at a ‘simple’ variable that should never have errored, right? Or so I thought. The error was pointing to this simple line:<br>
 <code>val dbNormalize = Point(-y, x)</code><br>
 At first glance it looks like a completely valid piece of code, but the field was actually declared in the <code>Point</code> data class. The Java equivalent of this would be perfectly valid, but for this you need to specify a custom getter like this:<br>
 <code> val dbNormalize get() = Point(-y, x)</code><br>
 The full form of any Kotlin field is as follows:
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> val foo:type = type(a, b, c...)  
     get() = field  
     set(value) {
     field = value
 }
</code></pre></div>    </div>
  </li>
  <li>Extension Functions<br>
 Extension functions were the thing that really made me feel good about switching to Kotlin. The amount of flexibility it offers is amazing. They provide you to define custom functions for any class but “extending” it. This also applies to fields/properties. For example, look at the following example. In FTC angle math is used a lot, and we always want to make sure that the angles we use are between some specified bounds, usually between -π and π.
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> fun Double.wrap(): Double {  
     angle = this
     while(angle &gt;= PI)
         angle -= PI * 2
     while(angle &lt; -PI)
         angle += PI * 2
     return angle
 }

 val Double.toRadians: Double = Math.toRadians(this)
 val Double.toDegrees: Double = Math.toDegrees(this)
</code></pre></div>    </div>

    <p>Now I can call this method on any double, like this.</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> val myAngleDegrees = 180.0
 val myAngleRad = myAngleDegrees.toRadians
 println(myAngleRad.wrap().toDegrees)
    
 Output: -180.0
</code></pre></div>    </div>
  </li>
  <li>
    <p>Null Safety<br>
 Kotlin is supposed to be safe, so what does it do with the dreaded null-types? Simple, nothing can be null unless specifically stated, and even if it is null, there are compile-time checks to make sure nothing goes haywire. To declare a variable as possibly null, you add the <code>?</code> to the end of the type declaration, like this.<br>
 <code>var foo: String? = "abc"</code><br>
 But what happens if it is null? At compile time if you ever access <code>foo</code> without checking if it’s null, Kotlin will throw a “can possibly be null” error. The correct way to access <code>foo</code> would be like this.<br>
 <code>val length = foo?.length ?: -1</code><br>
 This is equivalent to the following, more verbose expression.<br>
 <code>val l: Int = if(foo != null) foo.length else -1</code><br>
 And if you really do love having Null Pointer Exceptions, you can assert that a field is not null with <code>!!</code>. Ex:<br>
 <code>val l = b!!.length</code></p>
  </li>
  <li>
    <p>kotlin.math<br>
 This is a short one, but the built in extension functions in the kotlin.math class feel really good to use, such as the <code>Double.sign</code> extension field or the <code>Double.exp</code> function.</p>
  </li>
  <li>Operator Overloading<br>
 Operator overloading is a must know for anyone who frequently uses any sort of data class such as the aforementioned <code>Vector</code> or <code>Point</code> data classes. Basic unary/binary operators such as the increment operator or the adding operator can be overloaded with your custom definition. Let me just show how much cleaner it is.
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> data class Point(var x: Int, var y: Int) {
     operator fun plus(p: Point) = Point(x + p.x, y + p.y)
     operator fun times(n: Double) = Point(x * n, y * n)
     operator fun unaryMinus(p: Point) = this.times(-1.0)

     override fun toString() = x + ", " + y
 }

 fun main() {
     val foo = Point(2,3)
     val bar = Point(3,2)
     val foobar = foo + bar
     println(foobar.toString())
     val minusfoobar = -foobar
     println(minusfoo.toString()
 }

 Output: 
 5, 5
 -5, -5
</code></pre></div>    </div>
  </li>
  <li>Infix Functions<br>
 Can’t talk about operator overloading without mentioning infix functions. Infix functions are functions that can be called without the dot. I’m not that much of a fan of this due to the possible danger of making stuff so simple that it gets way too overcomplicated, but it does have its uses. Sometimes when I want to approximate something equal to another, I would previously have to do this: <code>Math.abs(a-b) &lt; 1e6 </code>, but with infix notation it becomes a lot cleaner.
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> infix fun Double.epsilonEquals(a: Double): Boolean {
     return if(this.isInfinite()) 
         this == a
     else 
         (this - a).absoluteValue &lt; EPSILON
 }

 fun main() {
     val foo = 1.0
     val bar = foo * 1.00000000000001
     println(foo epsilonEquals bar)
 }

 Output: true
</code></pre></div>    </div>
  </li>
  <li>When Statement<br>
 Using the when statement is like saying goodbye to the <code>if</code> and <code>switch</code> (well, Kotlin doesn’t have a switch statement anyway) statements: you’ll never want to go back again. Just look at this example in my FTC Angle data class and you’ll understand what I mean.
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> val deg: Double
     get() = when(unit) {
         AngleUnit.RAD -&gt; angle.toDegrees
         AngleUnit.DEG -&gt; angle
         AngleUnit.RAW -&gt; angle
     }
</code></pre></div>    </div>
    <p>Or when determining the metadata of a <code>Waypoint</code>:</p>
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> val skip: Boolean = when(waypoint) {
     is StopWaypoint -&gt; ....
     is TurnWaypoint -&gt; ....
     is LateTurnWaypoint -&gt; ....
     else -&gt; ....
 }
</code></pre></div>    </div>
    <p>See what I mean?</p>
  </li>
  <li>Break labels<br>
 Oftentimes I found myself annoyed with Java not having a specific break when inside nested statements/loops. Kotlin solves this annoyance with <code>labels</code>. Labels can annotate an expression, and breaks/returns can then jump straight to that label when that label is called.
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> mainLoop@ for(i in 1..100) {
     for(j in 1..100) {
         if(...) break@mainLoop
     }
 }
</code></pre></div>    </div>
    <p>Upon that nested <code>if</code> being fulfilled, the program will break out of both for loops.</p>
  </li>
  <li>Java Interoperability<br>
Last but not least is Kotlin being fully compatible with Java. Any libraries written in Java can be used in Kotlin without any trouble, and any Kotlin classes can be used in Java with some extra annotations. Any Kotlin fields that are being used in a Java class must be labled with the <code>@JVMField</code> annotation, or with the <code>@JVMStatic</code> annotation if it’s a static field.</li>
</ol>

<p>Thanks for reading, if you have any comments or concerns you can reach me at <a href="mailto:%20neilmehra@outlook.com">my email</a>.</p>


  </div><a class="u-url" href="/my-blog/ftc/kotlin/2021/08/19/Kotlin-FTC-Tips.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/my-blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/my-blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/my-blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/fastai" title="fastai"><svg class="svg-icon grey"><use xlink:href="/my-blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/my-blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
